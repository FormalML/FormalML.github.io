
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module FormalML.CertRL.qvalues</title>
<meta name="description" content="Documentation of Coq module FormalML.CertRL.qvalues" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module FormalML.CertRL.qvalues</h1>
<div class="coq">
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="FormalML.CertRL.mdp.html">mdp</a></span> <span class="id"><a href="FormalML.CertRL.LM.fixed_point.html">fixed_point</a></span> <span class="id"><a href="FormalML.CertRL.pmf_monad.html">pmf_monad</a></span> <span class="id"><a href="FormalML.utils.Finite.html">Finite</a></span> <span class="id"><a href="FormalML.utils.ListAdd.html">ListAdd</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Reals.html">Reals</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html">Coq.Lists.List</a></span> <span class="id"><a href="FormalML.lib_utils.LibUtils.html">LibUtils</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.micromega.Lra.html">micromega.Lra</a></span>. <br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Logic.ClassicalDescription.html">ClassicalDescription</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="FormalML.utils.RealAdd.html">RealAdd</a></span> <span class="id"><a href="FormalML.lib_utils.LibUtilsListAdd.html">LibUtilsListAdd</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Classes.EquivDec.html">EquivDec</a></span>.<br/>
<br/>
<span class="kwd">Import</span> <span class="id">ListNotations</span>.<br/>
<span class="kwd">Set</span> <span class="id">Bullet</span> <span class="id">Behavior</span> "<span class="id">Strict</span> <span class="id">Subproofs</span>".<br/>
<br/>
<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="bellmanQbar">bellmanQbar</a></span>.<br/>
<span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">R_scope</span>.<br/>
<span class="kwd">Context</span> {<span class="id">M</span> : <span class="id"><a href="FormalML.CertRL.mdp.html#MDP">MDP</a></span>} (γ : <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span>).<br/>
<span class="kwd">Context</span> (σ : <span class="id"><a href="FormalML.CertRL.mdp.html#dec_rule">dec_rule</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQbar.M">M</a></span>) (<span class="id">init</span> : <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQbar.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#state">state</a></span>)) (<span class="id">h</span>γ : (0 &lt;= γ &lt; 1)%<span class="id">R</span>).<br/>
<span class="kwd">Arguments</span> <span class="id"><a href="FormalML.CertRL.mdp.html#reward">reward</a></span> {<span class="id">_</span>}.<br/>
<span class="kwd">Arguments</span> <span class="id"><a href="FormalML.CertRL.pmf_monad.html#outcomes">outcomes</a></span> {<span class="id">_</span>}.<br/>
<span class="kwd">Arguments</span> <span class="id"><a href="FormalML.CertRL.mdp.html#t">t</a></span> {<span class="id">_</span>}.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="act_expt_reward">act_expt_reward</a></span> : <span class="kwd">forall</span> <span class="id">s</span> : <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQbar.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#state">state</a></span>), <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQbar.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span>) <span class="id">s</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span> :=<br/>
&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">s</span> <span class="id">a</span> =&gt; <span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value">expt_value</a></span> (<span class="id"><a href="FormalML.CertRL.mdp.html#t">t</a></span> <span class="id">s</span> <span class="id">a</span>) (<span class="id"><a href="FormalML.CertRL.mdp.html#reward">reward</a></span> <span class="id">s</span> <span class="id">a</span>)).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Qvalue">Qvalue</a></span> : <span class="kwd">forall</span> <span class="id">s</span>: <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQbar.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#state">state</a></span>), (<span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQbar.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span>) <span class="id">s</span>) -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">s</span> <span class="id">a</span> =&gt; <span class="id"><a href="FormalML.CertRL.qvalues.html#act_expt_reward">act_expt_reward</a></span> <span class="id">s</span> <span class="id">a</span> + γ*<span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value">expt_value</a></span> (<span class="id"><a href="FormalML.CertRL.mdp.html#t">t</a></span> <span class="id">s</span> <span class="id">a</span>) (<span class="id"><a href="FormalML.CertRL.mdp.html#ltv">ltv</a></span> γ σ).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Qvalue_expt_value">Qvalue_expt_value</a></span> : <span class="kwd">forall</span> <span class="id">s</span> <span class="id">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FormalML.CertRL.qvalues.html#Qvalue">Qvalue</a></span> <span class="id">s</span> <span class="id">a</span> = <span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value">expt_value</a></span> (<span class="id"><a href="FormalML.CertRL.mdp.html#t">t</a></span> <span class="id">s</span> <span class="id">a</span>) (<span class="kwd">fun</span> <span class="id">s</span>' =&gt; <span class="id"><a href="FormalML.CertRL.mdp.html#reward">reward</a></span> <span class="id">s</span> <span class="id">a</span> <span class="id">s</span>' + γ*(<span class="id"><a href="FormalML.CertRL.mdp.html#ltv">ltv</a></span> γ σ <span class="id">s</span>')).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof1')">Proof.</span></div>
<div class="proofscript" id="proof1">
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">unfold</span> <span class="id"><a href="FormalML.CertRL.qvalues.html#Qvalue">Qvalue</a></span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="FormalML.CertRL.qvalues.html#act_expt_reward">act_expt_reward</a></span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> &lt;-<span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value_const_mul">expt_value_const_mul</a></span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value_add">expt_value_add</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="ltv_Qvalue">ltv_Qvalue</a></span> : <span class="id"><a href="FormalML.CertRL.mdp.html#ltv">ltv</a></span> γ σ <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQbar.init">init</a></span> = <span class="id"><a href="FormalML.CertRL.qvalues.html#Qvalue">Qvalue</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQbar.init">init</a></span> (σ <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQbar.init">init</a></span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof2')">Proof.</span></div>
<div class="proofscript" id="proof2">
&nbsp;&nbsp;<span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="FormalML.CertRL.mdp.html#ltv_corec">ltv_corec</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="bellmanQbar">bellmanQbar</a></span> : <span class="id"><a href="FormalML.CertRL.mdp.html#Rfct">Rfct</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#sigT">sigT</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQbar.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span>)) -&gt; <span class="id"><a href="FormalML.CertRL.mdp.html#Rfct">Rfct</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#sigT">sigT</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQbar.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span>))<br/>
&nbsp;&nbsp;:= <span class="kwd">fun</span> <span class="id">W</span> =&gt; <span class="kwd">fun</span> <span class="id">sa</span> =&gt; <span class="kwd">let</span> (<span class="id">s</span>,<span class="id">a</span>) := <span class="id">sa</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FormalML.CertRL.qvalues.html#act_expt_reward">act_expt_reward</a></span> <span class="id">s</span> <span class="id">a</span> +<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;γ*<span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value">expt_value</a></span> (<span class="id"><a href="FormalML.CertRL.mdp.html#t">t</a></span> <span class="id">s</span> <span class="id">a</span>)(<span class="kwd">fun</span> <span class="id">s</span>' =&gt; <span class="id">Max_</span>{<span class="id"><a href="FormalML.CertRL.mdp.html#act_list">act_list</a></span> <span class="id">s</span>'}(<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id">W</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">s</span>' <span class="id">a</span>) ) ).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="bellmanQbar_expt_value">bellmanQbar_expt_value</a></span> : <span class="kwd">forall</span> <span class="id">s</span> <span class="id">a</span> <span class="id">W</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQbar">bellmanQbar</a></span> <span class="id">W</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">s</span> <span class="id">a</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value">expt_value</a></span> (<span class="id"><a href="FormalML.CertRL.mdp.html#t">t</a></span> <span class="id">s</span> <span class="id">a</span>) (<span class="kwd">fun</span> <span class="id">s</span>' =&gt; <span class="id"><a href="FormalML.CertRL.mdp.html#reward">reward</a></span> <span class="id">s</span> <span class="id">a</span> <span class="id">s</span>' + γ*(<span class="id">Max_</span>{<span class="id"><a href="FormalML.CertRL.mdp.html#act_list">act_list</a></span> <span class="id">s</span>'}(<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id">W</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">s</span>' <span class="id">a</span>)))).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof3')">Proof.</span></div>
<div class="proofscript" id="proof3">
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">unfold</span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQbar">bellmanQbar</a></span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="FormalML.CertRL.qvalues.html#act_expt_reward">act_expt_reward</a></span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> &lt;-<span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value_const_mul">expt_value_const_mul</a></span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value_add">expt_value_add</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Rabs_helper">Rabs_helper</a></span> : <span class="kwd">forall</span> <span class="id">a</span> <span class="id">b</span> <span class="id">c</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs">Rabs</a></span> ( (<span class="id">a</span> + <span class="id">b</span>) + -(<span class="id">a</span> + <span class="id">c</span>)) = <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs">Rabs</a></span> (<span class="id">b</span> - <span class="id">c</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof4')">Proof.</span></div>
<div class="proofscript" id="proof4">
&nbsp;&nbsp;<span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">f_equal</span>. <span class="id">lra</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="is_contraction_bellmanQbar">is_contraction_bellmanQbar</a></span> :<br/>
&nbsp;&nbsp;@<span class="id"><a href="FormalML.CertRL.LM.fixed_point.html#is_contraction">is_contraction</a></span> (<span class="id"><a href="FormalML.CertRL.mdp.html#Rfct_UniformSpace">Rfct_UniformSpace</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#sigT">sigT</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQbar.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span>))) (<span class="id"><a href="FormalML.CertRL.mdp.html#Rfct_UniformSpace">Rfct_UniformSpace</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#sigT">sigT</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQbar.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQbar">bellmanQbar</a></span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof5')">Proof.</span></div>
<div class="proofscript" id="proof5">
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="FormalML.CertRL.LM.fixed_point.html#is_contraction">is_contraction</a></span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Req_EM_T">Req_EM_T</a></span> γ 0).<br/>
&nbsp;&nbsp;++ <span class="id">unfold</span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQbar">bellmanQbar</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (1/2). <span class="id">split</span>; [<span class="id">lra</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="FormalML.CertRL.LM.fixed_point.html#is_Lipschitz">is_Lipschitz</a></span>. <span class="id">split</span>;<span class="id">trivial</span>;[<span class="id">lra</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="FormalML.CertRL.mdp.html#fs">fs</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQbar.M">M</a></span>) <span class="kwd">as</span> [<span class="id">ls</span> ?].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">f</span> <span class="id">g</span> <span class="id">r</span> <span class="id">Hr</span> <span class="id">Hfgr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">e</span>. <span class="id">unfold</span> <span class="id"><a href="FormalML.CertRL.LM.fixed_point.html#ball_x">ball_x</a></span>,<span class="id"><a href="FormalML.CertRL.LM.fixed_point.html#ball_y">ball_y</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">unfold</span> <span class="id"><a href="FormalML.CertRL.mdp.html#Rmax_ball">Rmax_ball</a></span>,<span class="id"><a href="FormalML.CertRL.mdp.html#Rmax_norm">Rmax_norm</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="FormalML.CertRL.mdp.html#act_finite">act_finite</a></span> <span class="kwd">as</span> [<span class="id">acts</span> ?].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_list_lt_iff">Rmax_list_lt_iff</a></span>; <span class="id">intros</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">try</span> (<span class="id">apply</span> <span class="id"><a href="FormalML.utils.ListAdd.html#map_not_nil">map_not_nil</a></span>; <span class="id">apply</span> <span class="id"><a href="FormalML.utils.ListAdd.html#not_nil_exists">not_nil_exists</a></span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> (<span class="id"><a href="FormalML.CertRL.mdp.html#ne">ne</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQbar.M">M</a></span>) ((<span class="id"><a href="FormalML.CertRL.mdp.html#na">na</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQbar.M">M</a></span>) (<span class="id"><a href="FormalML.CertRL.mdp.html#ne">ne</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQbar.M">M</a></span>))); <span class="id">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id">minus</span>,<span class="id">plus</span>,<span class="id">opp</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">x0</span> <span class="kwd">as</span> [<span class="id">s</span> <span class="id">a</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">H1</span> <span class="id">H2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> 2 <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rmult_0_l">Rmult_0_l</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs_def1">Rabs_def1</a></span> ; <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">replace</span> (0) <span class="kwd">with</span> ((1/2)*0) <span class="kwd">by</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rmult_lt_compat_l">Rmult_lt_compat_l</a></span>; <span class="id">trivial</span>; <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Ropp_mult_distr_l_reverse">Ropp_mult_distr_l_reverse</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Ropp_lt_gt_0_contravar">Ropp_lt_gt_0_contravar</a></span> <span class="kwd">with</span> (<span class="id">r</span> := (1/2)*<span class="id">r</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">replace</span> (0) <span class="kwd">with</span> ((1/2)*0) <span class="kwd">by</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rmult_lt_compat_l">Rmult_lt_compat_l</a></span>; <span class="id">trivial</span>; <span class="id">lra</span>.<br/>
&nbsp;&nbsp;++ <span class="kwd">exists</span> γ ; <span class="id">split</span>.<br/>
&nbsp;&nbsp;- <span class="id">now</span> <span class="id">destruct</span> <span class="id">h</span>γ.<br/>
&nbsp;&nbsp;- <span class="id">unfold</span> <span class="id"><a href="FormalML.CertRL.LM.fixed_point.html#is_Lipschitz">is_Lipschitz</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="FormalML.CertRL.LM.fixed_point.html#ball_x">ball_x</a></span>,<span class="id"><a href="FormalML.CertRL.LM.fixed_point.html#ball_y">ball_y</a></span>. <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="FormalML.CertRL.mdp.html#fs">fs</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQbar.M">M</a></span>) <span class="kwd">as</span> [<span class="id">ls</span> <span class="id">Hls</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">now</span> <span class="id">destruct</span> <span class="id">h</span>γ.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">intros</span> <span class="id">f</span> <span class="id">g</span> <span class="id">r</span> <span class="id">Hr</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">red</span> <span class="kwd">in</span> <span class="id">Hx</span> |-.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="FormalML.CertRL.mdp.html#Rmax_ball">Rmax_ball</a></span>, <span class="id"><a href="FormalML.CertRL.mdp.html#Rmax_norm">Rmax_norm</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="FormalML.CertRL.mdp.html#act_finite">act_finite</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQbar.M">M</a></span>) <span class="kwd">as</span> [<span class="id">la</span> <span class="id">Hla</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_list_lt_iff">Rmax_list_lt_iff</a></span>; <span class="id">intros</span>; <span class="id">try</span>(<span class="id">apply</span> <span class="id"><a href="FormalML.utils.ListAdd.html#map_not_nil">map_not_nil</a></span>; <span class="id">apply</span> <span class="id"><a href="FormalML.utils.ListAdd.html#not_nil_exists">not_nil_exists</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">sa</span> [<span class="id">Q</span> <span class="id">HQ</span>]]; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id">minus</span>, <span class="id">plus</span>, <span class="id">opp</span>. <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQbar">bellmanQbar</a></span>; <span class="id">destruct</span> <span class="id">sa</span>. <span class="id">rewrite</span> <span class="id"><a href="FormalML.CertRL.qvalues.html#Rabs_helper">Rabs_helper</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;-<span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rmult_minus_distr_l">Rmult_minus_distr_l</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs_mult">Rabs_mult</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hr</span>γ : <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs">Rabs</a></span> γ = γ) <span class="kwd">by</span> (<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs_pos_eq">Rabs_pos_eq</a></span>; <span class="id">lra</span>). <span class="id">rewrite</span> <span class="id">Hr</span>γ.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rmult_lt_compat_l">Rmult_lt_compat_l</a></span>; <span class="id">try</span> (<span class="id">destruct</span> <span class="id">h</span>γ; <span class="id">lra</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;-<span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value_sub">expt_value_sub</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_lt_trans">Rle_lt_trans</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="FormalML.CertRL.mdp.html#Rmax_norm">Rmax_norm</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_trans">Rle_trans</a></span>. <span class="id">apply</span> <span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value_Rabs_Rle">expt_value_Rabs_Rle</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value_bdd">expt_value_bdd</a></span>; <span class="id">intro</span> <span class="id">s0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="FormalML.CertRL.mdp.html#act_list">act_list</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQbar.M">M</a></span> <span class="id">s0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_trans">Rle_trans</a></span>. <span class="id">apply</span> <span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_list_minus_le_abs">Rmax_list_minus_le_abs</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_list_le_iff">Rmax_list_le_iff</a></span>; <span class="id">try</span> (<span class="id">rewrite</span> <span class="id"><a href="FormalML.utils.ListAdd.html#map_not_nil">map_not_nil</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">r</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">a0</span> [<span class="id">Ha0</span> <span class="id">Helms</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subst</span>. <span class="id">apply</span> <span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_spec">Rmax_spec</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">s0</span> <span class="id">a0</span>); <span class="id">now</span> <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="FormalML.utils.ListAdd.html#not_nil_exists">not_nil_exists</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> (<span class="id"><a href="FormalML.CertRL.mdp.html#na">na</a></span> <span class="id">_</span> <span class="id">s0</span>); <span class="id">intros</span> <span class="id">a0</span>; <span class="id">now</span> <span class="kwd">exists</span> <span class="id">a0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> (<span class="id"><a href="FormalML.CertRL.mdp.html#ne">ne</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQbar.M">M</a></span>); <span class="id">intros</span> <span class="id">s0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> (<span class="id"><a href="FormalML.CertRL.mdp.html#na">na</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQbar.M">M</a></span>); <span class="id">intros</span> <span class="id">a0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">a0</span> <span class="id">s0</span>). <span class="id">now</span> <span class="kwd">exists</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">s0</span> <span class="id">a0</span>).<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQbar">bellmanQbar</a></span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="bellmanQ">bellmanQ</a></span>.<br/>
<span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">R_scope</span>.<br/>
<span class="kwd">Context</span> {<span class="id">M</span> : <span class="id"><a href="FormalML.CertRL.mdp.html#MDP">MDP</a></span>} (γ : <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span>).<br/>
<span class="kwd">Context</span> (σ : <span class="id"><a href="FormalML.CertRL.mdp.html#dec_rule">dec_rule</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>) (<span class="id">init</span> : <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#state">state</a></span>)) (<span class="id">h</span>γ : (0 &lt;= γ &lt; 1)%<span class="id">R</span>).<br/>
<span class="kwd">Arguments</span> <span class="id"><a href="FormalML.CertRL.mdp.html#reward">reward</a></span> {<span class="id">_</span>}.<br/>
<span class="kwd">Arguments</span> <span class="id"><a href="FormalML.CertRL.pmf_monad.html#outcomes">outcomes</a></span> {<span class="id">_</span>}.<br/>
<span class="kwd">Arguments</span> <span class="id"><a href="FormalML.CertRL.mdp.html#t">t</a></span> {<span class="id">_</span>}.<br/>
<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="fun_inner_prod">fun_inner_prod</a></span> {<span class="id">A</span> : <span class="kwd">Type</span>} (<span class="id">f</span> <span class="id">g</span> : <span class="id">A</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span>) (<span class="id">ls</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span> :=<br/>
&nbsp;&nbsp;(<span class="id"><a href="FormalML.utils.RealAdd.html#list_sum">list_sum</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">a</span> =&gt; (<span class="id">f</span> <span class="id">a</span>)*(<span class="id">g</span> <span class="id">a</span>)) <span class="id">ls</span>)).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="fun_inner_prod_self">fun_inner_prod_self</a></span> {<span class="id">A</span> : <span class="kwd">Type</span>} (<span class="id">l</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>) (<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span>) :<br/>
&nbsp;&nbsp;<span class="id"><a href="FormalML.CertRL.qvalues.html#fun_inner_prod">fun_inner_prod</a></span> <span class="id">f</span> <span class="id">f</span> <span class="id">l</span> = <span class="id"><a href="FormalML.utils.RealAdd.html#list_sum">list_sum</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rsqr">Rsqr</a></span> (<span class="id">f</span> <span class="id">a</span>)) <span class="id">l</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof6')">Proof.</span></div>
<div class="proofscript" id="proof6">
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="FormalML.CertRL.qvalues.html#fun_inner_prod">fun_inner_prod</a></span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="id">apply</span> <span class="id"><a href="FormalML.utils.RealAdd.html#list_sum_map_ext">list_sum_map_ext</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Rfct_inner">Rfct_inner</a></span> {<span class="id">A</span> : <span class="kwd">Type</span>} (<span class="id">finA</span> : <span class="id"><a href="FormalML.utils.Finite.html#Finite">Finite</a></span> <span class="id">A</span>) (<span class="id">f</span> <span class="id">g</span> : <span class="id"><a href="FormalML.CertRL.mdp.html#Rfct">Rfct</a></span> <span class="id">A</span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">ls</span>, <span class="id">_</span>) := <span class="id">finA</span> <span class="kwd">in</span> <span class="id"><a href="FormalML.CertRL.qvalues.html#fun_inner_prod">fun_inner_prod</a></span> <span class="id">f</span> <span class="id">g</span> <span class="id">ls</span>.<br/>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Rfct_expt_inner">Rfct_expt_inner</a></span> {<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>} (<span class="id">finA</span> : <span class="id"><a href="FormalML.utils.Finite.html#Finite">Finite</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">f</span> : <span class="id">B</span> -&gt; <span class="id"><a href="FormalML.CertRL.mdp.html#Rfct">Rfct</a></span> <span class="id">A</span>) (<span class="id">p</span> : <span class="id"><a href="FormalML.CertRL.pmf_monad.html#Pmf">Pmf</a></span> <span class="id">B</span>):<br/>
&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">la</span>, <span class="id">_</span>) := <span class="id">finA</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value">expt_value</a></span> <span class="id">p</span> (<span class="kwd">fun</span> <span class="id">b</span> =&gt; <span class="id"><a href="FormalML.CertRL.qvalues.html#Rfct_inner">Rfct_inner</a></span> <span class="id">_</span> (<span class="id">f</span> <span class="id">b</span>) (<span class="id">f</span> <span class="id">b</span>)) =<br/>
&nbsp;&nbsp;<span class="id"><a href="FormalML.utils.RealAdd.html#list_sum">list_sum</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value">expt_value</a></span> <span class="id">p</span> (<span class="kwd">fun</span> <span class="id">b</span> =&gt; (<span class="id">f</span> <span class="id">b</span> <span class="id">a</span>)*(<span class="id">f</span> <span class="id">b</span> <span class="id">a</span>))) <span class="id">la</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof7')">Proof.</span></div>
<div class="proofscript" id="proof7">
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="FormalML.CertRL.qvalues.html#Rfct_inner">Rfct_inner</a></span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">finA</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">p</span> <span class="kwd">as</span> [<span class="id">lp</span> <span class="id">Hlp</span>]. <span class="id">unfold</span> <span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value">expt_value</a></span>.<br/>
&nbsp;&nbsp;<span class="id">simpl</span>. <span class="id">clear</span> <span class="id">Hlp</span>.<br/>
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">lp</span>.<br/>
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">lp</span>.<br/>
&nbsp;&nbsp;+ <span class="id">simpl</span>. <span class="id">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="FormalML.utils.RealAdd.html#list_sum_map_zero">list_sum_map_zero</a></span>.<br/>
&nbsp;&nbsp;+ <span class="id">simpl</span>. <span class="id">rewrite</span> <span class="id">IHlp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="FormalML.utils.RealAdd.html#list_sum_map_add">list_sum_map_add</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f_equal</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rmult_comm">Rmult_comm</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="FormalML.CertRL.qvalues.html#fun_inner_prod">fun_inner_prod</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;-<span class="id"><a href="FormalML.utils.RealAdd.html#list_sum_const_mul">list_sum_const_mul</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f_equal</span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext">List.map_ext</a></span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lra</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="bellmanQ">bellmanQ</a></span> : <span class="id"><a href="FormalML.CertRL.mdp.html#Rfct">Rfct</a></span>(<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#sigT">sigT</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span>)) -&gt; <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#state">state</a></span>) -&gt; <span class="id"><a href="FormalML.CertRL.mdp.html#Rfct">Rfct</a></span>(<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#sigT">sigT</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span>))<br/>
&nbsp;&nbsp;:= <span class="kwd">fun</span> <span class="id">W</span> =&gt; <span class="kwd">fun</span> <span class="id">s</span>' <span class="id">sa</span> =&gt; <span class="kwd">let</span> (<span class="id">s</span>,<span class="id">a</span>) := <span class="id">sa</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FormalML.CertRL.mdp.html#reward">reward</a></span> <span class="id">s</span> <span class="id">a</span> <span class="id">s</span>' + γ*<span class="id">Max_</span>{<span class="id"><a href="FormalML.CertRL.mdp.html#act_list">act_list</a></span> <span class="id">s</span>'}(<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id">W</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">s</span>' <span class="id">a</span>)).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="expt_value_le_max">expt_value_le_max</a></span> {<span class="id">A</span> : <span class="kwd">Type</span>} (<span class="id">finA</span> : <span class="id"><a href="FormalML.utils.Finite.html#Finite">Finite</a></span> <span class="id">A</span>) (<span class="id">p</span> : <span class="id"><a href="FormalML.CertRL.pmf_monad.html#Pmf">Pmf</a></span> <span class="id">A</span>) (<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span>):<br/>
&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">la</span>,<span class="id">_</span>) := <span class="id">finA</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value">expt_value</a></span> <span class="id">p</span> <span class="id">f</span> &lt;= <span class="id">Max_</span>{<span class="id">la</span>}(<span class="id">f</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof8')">Proof.</span></div>
<div class="proofscript" id="proof8">
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">finA</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value_bdd">expt_value_bdd</a></span>.<br/>
&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">apply</span> <span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_spec">Rmax_spec</a></span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">List.in_map_iff</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">a</span>. <span class="id">split</span>; <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Rmax_list_Rsqr_Rabs_1">Rmax_list_Rsqr_Rabs_1</a></span> {<span class="id">A</span> : <span class="kwd">Type</span>} (<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span>) (<span class="id">l</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>):<br/>
[] &lt;&gt; <span class="id">l</span> -&gt; <span class="id">Max_</span>{<span class="id">l</span>}(<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rsqr">Rsqr</a></span> (<span class="id">f</span> <span class="id">a</span>)) &lt;= <span class="id">Max_</span>{<span class="id">l</span>}(<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rsqr">Rsqr</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs">Rabs</a></span> (<span class="id">f</span> <span class="id">a</span>))).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof9')">Proof.</span></div>
<div class="proofscript" id="proof9">
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">Hn</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_spec">Rmax_spec</a></span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_list_map_exist">Rmax_list_map_exist</a></span> (<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rsqr">Rsqr</a></span> (<span class="id">f</span> <span class="id">a</span>)) <span class="id">l</span> <span class="id">Hn</span>) <span class="kwd">as</span> [<span class="id">a</span> [<span class="id">Ha1</span> <span class="id">Ha2</span>]].<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">a</span>.  <span class="id">rewrite</span> &lt;-<span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.R_sqr.html#Rsqr_abs">Rsqr_abs</a></span>.<br/>
&nbsp;&nbsp;<span class="id">split</span>; <span class="id">trivial</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Rmax_list_Rsqr_Rabs_2">Rmax_list_Rsqr_Rabs_2</a></span> {<span class="id">A</span> : <span class="kwd">Type</span>} (<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span>) (<span class="id">l</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>):<br/>
&nbsp;&nbsp;[] &lt;&gt; <span class="id">l</span> -&gt; <span class="id">Max_</span>{<span class="id">l</span>}(<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rsqr">Rsqr</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs">Rabs</a></span> (<span class="id">f</span> <span class="id">a</span>))) &lt;= <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rsqr">Rsqr</a></span>(<span class="id">Max_</span>{<span class="id">l</span>}(<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs">Rabs</a></span>(<span class="id">f</span> <span class="id">a</span>))).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof10')">Proof.</span></div>
<div class="proofscript" id="proof10">
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">Hn</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_list_map_exist">Rmax_list_map_exist</a></span> (<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rsqr">Rsqr</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs">Rabs</a></span> (<span class="id">f</span> <span class="id">a</span>))) <span class="id">l</span> <span class="id">Hn</span>) <span class="kwd">as</span> [<span class="id">a</span> [<span class="id">Ha1</span> <span class="id">Ha2</span>]].<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> &lt;-<span class="id">Ha2</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.R_sqr.html#neg_pos_Rsqr_le">neg_pos_Rsqr_le</a></span>; <span class="id">try</span> (<span class="id">apply</span> <span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_spec">Rmax_spec</a></span> ; <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span> ; <span class="kwd">exists</span> <span class="id">a</span>; <span class="id">split</span>; <span class="id">trivial</span>).<br/>
&nbsp;&nbsp;<span class="id">replace</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs">Rabs</a></span> (<span class="id">f</span> <span class="id">a</span>)) <span class="kwd">with</span> (- (- (<span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs">Rabs</a></span> (<span class="id">f</span> <span class="id">a</span>)))) <span class="kwd">by</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Ropp_le_contravar">Ropp_le_contravar</a></span>.<br/>
&nbsp;&nbsp;<span class="id">transitivity</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs">Rabs</a></span> (<span class="id">f</span> <span class="id">a</span>)) ; <span class="id">try</span> (<span class="id">apply</span> <span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_spec">Rmax_spec</a></span> ; <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span> ; <span class="kwd">exists</span> <span class="id">a</span>; <span class="id">split</span>; <span class="id">trivial</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Rminus_le_0</span>.<br/>
&nbsp;&nbsp;<span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rmult_le_pos">Rmult_le_pos</a></span>; <span class="id">try</span> (<span class="id">left</span>; <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.setoid_ring.RealField.html#Rlt_0_2">Rlt_0_2</a></span>).<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs_pos">Rabs_pos</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Rmax_list_Rsqr_Rabs_3">Rmax_list_Rsqr_Rabs_3</a></span> {<span class="id">A</span> : <span class="kwd">Type</span>} (<span class="id">f</span> <span class="id">g</span> : <span class="id">A</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span>) (<span class="id">l</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>):<br/>
&nbsp;&nbsp;[] &lt;&gt; <span class="id">l</span> -&gt; (<span class="id">Max_</span>{<span class="id">l</span>}(<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs">Rabs</a></span> (<span class="id">f</span> <span class="id">a</span> + <span class="id">g</span> <span class="id">a</span>)))² &lt;=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Max_</span>{<span class="id">l</span>}(<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs">Rabs</a></span>(<span class="id">f</span> <span class="id">a</span>)) + <span class="id">Max_</span>{<span class="id">l</span>}(<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs">Rabs</a></span> (<span class="id">g</span> <span class="id">a</span>)))².<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof11')">Proof.</span></div>
<div class="proofscript" id="proof11">
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">Hn</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.R_sqr.html#Rsqr_incr_1">Rsqr_incr_1</a></span>; <span class="id">try</span> (<span class="id">apply</span> <span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_list_map_nonneg">Rmax_list_map_nonneg</a></span>).<br/>
&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_list_map_triangle">Rmax_list_map_triangle</a></span>.<br/>
&nbsp;&nbsp;+ <span class="id">intros</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs_pos">Rabs_pos</a></span>.<br/>
&nbsp;&nbsp;+ <span class="id">replace</span> 0 <span class="kwd">with</span> (0+0) <span class="kwd">by</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rplus_le_compat">Rplus_le_compat</a></span>; <span class="id">apply</span> <span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_list_map_nonneg">Rmax_list_map_nonneg</a></span>; <span class="id">intros</span>; <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs_pos">Rabs_pos</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="minus_Rsqr_le">minus_Rsqr_le</a></span> (<span class="id">a</span> <span class="id">b</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span>):<br/>
&nbsp;&nbsp;<span class="id">a</span> - <span class="id">b</span>² &lt;= <span class="id">a</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof12')">Proof.</span></div>
<div class="proofscript" id="proof12">
&nbsp;&nbsp;<span class="id">rewrite</span> &lt;-<span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rminus_0_r">Rminus_0_r</a></span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#Rminus">Rminus</a></span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rplus_le_compat_l">Rplus_le_compat_l</a></span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Ropp_le_contravar">Ropp_le_contravar</a></span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rfunctions.html#Rsqr_pow2">Rsqr_pow2</a></span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Ratan.html#pow2_ge_0">pow2_ge_0</a></span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="summand_bound">summand_bound</a></span> <span class="id">W</span> := <span class="kwd">fun</span> (<span class="id">s</span> : <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#state">state</a></span>)) <span class="id">a</span> =&gt; <span class="kwd">let</span> (<span class="id">ls</span>,<span class="id">_</span>) := <span class="id"><a href="FormalML.CertRL.mdp.html#fs">fs</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Max_</span>{ <span class="id">ls</span>}(<span class="kwd">fun</span> <span class="id">a0</span> : <span class="id"><a href="FormalML.CertRL.mdp.html#state">state</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs">Rabs</a></span> ((<span class="kwd">fun</span> <span class="id">_</span> : <span class="id"><a href="FormalML.CertRL.mdp.html#state">state</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span> =&gt; <span class="id"><a href="FormalML.CertRL.qvalues.html#act_expt_reward">act_expt_reward</a></span> <span class="id">s</span> <span class="id">a</span>) <span class="id">a0</span>)) +<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Max_</span>{ <span class="id">ls</span>} (<span class="kwd">fun</span> <span class="id">a0</span> : <span class="id"><a href="FormalML.CertRL.mdp.html#state">state</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs">Rabs</a></span> ((<span class="kwd">fun</span> <span class="id">a1</span> : <span class="id"><a href="FormalML.CertRL.mdp.html#state">state</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span> =&gt; γ * (<span class="id">Max_</span>{ <span class="id"><a href="FormalML.CertRL.mdp.html#act_list">act_list</a></span> <span class="id">a1</span>}(<span class="kwd">fun</span> <span class="id">a2</span> : <span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span> <span class="id">a1</span> =&gt; <span class="id">W</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> (<span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>) <span class="id">a1</span> <span class="id">a2</span>)))) <span class="id">a0</span>))))².<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="summand_bounded">summand_bounded</a></span> <span class="id">W</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#state">state</a></span>)) (<span class="id">a</span>: <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span>) <span class="id">s</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">ls</span>,<span class="id">_</span>) := <span class="id"><a href="FormalML.CertRL.mdp.html#fs">fs</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FormalML.CertRL.pmf_monad.html#variance">variance</a></span> (<span class="id"><a href="FormalML.CertRL.mdp.html#t">t</a></span> <span class="id">s</span> <span class="id">a</span>) (<span class="kwd">fun</span> <span class="id">s</span>' =&gt; <span class="id"><a href="FormalML.CertRL.qvalues.html#act_expt_reward">act_expt_reward</a></span> <span class="id">s</span> <span class="id">a</span> + γ*<span class="id">Max_</span>{<span class="id"><a href="FormalML.CertRL.mdp.html#act_list">act_list</a></span> <span class="id">s</span>'} (<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id">W</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">s</span>' <span class="id">a</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;= <span class="id"><a href="FormalML.CertRL.qvalues.html#summand_bound">summand_bound</a></span> <span class="id">W</span> <span class="id">s</span> <span class="id">a</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof13')">Proof.</span></div>
<div class="proofscript" id="proof13">
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">s</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="FormalML.CertRL.qvalues.html#summand_bound">summand_bound</a></span>.<br/>
&nbsp;&nbsp;<span class="id">generalize</span> (<span class="id"><a href="FormalML.CertRL.qvalues.html#expt_value_le_max">expt_value_le_max</a></span> (<span class="id"><a href="FormalML.CertRL.mdp.html#fs">fs</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>) (<span class="id"><a href="FormalML.CertRL.mdp.html#t">t</a></span> <span class="id">s</span> <span class="id">a</span>)); <span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="FormalML.CertRL.mdp.html#fs">fs</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>) <span class="kwd">as</span> [<span class="id">ls</span> ?].<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hls</span>: [] &lt;&gt; <span class="id">ls</span>) <span class="kwd">by</span> (<span class="id">apply</span> <span class="id"><a href="FormalML.utils.ListAdd.html#not_nil_exists">not_nil_exists</a></span>; <span class="kwd">exists</span> (<span class="id"><a href="FormalML.CertRL.mdp.html#ne">ne</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>); <span class="id">trivial</span>).<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_trans">Rle_trans</a></span>; <span class="id">try</span> <span class="id">apply</span> <span class="id"><a href="FormalML.CertRL.pmf_monad.html#variance_le_expt_value_sqr">variance_le_expt_value_sqr</a></span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_trans">Rle_trans</a></span>; <span class="id">try</span> <span class="id">eapply</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_trans">Rle_trans</a></span>; <span class="id">try</span> (<span class="id">eapply</span> (<span class="id"><a href="FormalML.CertRL.qvalues.html#Rmax_list_Rsqr_Rabs_1">Rmax_list_Rsqr_Rabs_1</a></span>) ; <span class="id">trivial</span>).<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_trans">Rle_trans</a></span>; <span class="id">try</span> (<span class="id">eapply</span> (<span class="id"><a href="FormalML.CertRL.qvalues.html#Rmax_list_Rsqr_Rabs_2">Rmax_list_Rsqr_Rabs_2</a></span>) ; <span class="id">trivial</span>).<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_trans">Rle_trans</a></span>; <span class="id">try</span> (<span class="id">eapply</span> (<span class="id"><a href="FormalML.CertRL.qvalues.html#Rmax_list_Rsqr_Rabs_3">Rmax_list_Rsqr_Rabs_3</a></span>) ; <span class="id">trivial</span>).<br/>
&nbsp;&nbsp;<span class="id">right</span>; <span class="id">trivial</span>.<br/>
Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Rmax_list_map_add">Rmax_list_map_add</a></span> {<span class="id">A</span>} (<span class="id">f</span> <span class="id">g</span> : <span class="id">A</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span>) (<span class="id">l</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Max_</span>{ <span class="id">l</span>}(<span class="kwd">fun</span> <span class="id">a</span> : <span class="id">A</span> =&gt; (<span class="id">f</span> <span class="id">a</span> + <span class="id">g</span> <span class="id">a</span>)) &lt;=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Max_</span>{ <span class="id">l</span>}(<span class="kwd">fun</span> <span class="id">a</span> : <span class="id">A</span> =&gt; (<span class="id">f</span> <span class="id">a</span>)) + (<span class="id">Max_</span>{ <span class="id">l</span>}(<span class="kwd">fun</span> <span class="id">a</span> : <span class="id">A</span> =&gt; (<span class="id">g</span> <span class="id">a</span>))).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof14')">Proof.</span></div>
<div class="proofscript" id="proof14">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="FormalML.lib_utils.LibUtilsListAdd.html#is_nil_dec">is_nil_dec</a></span> <span class="id">l</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">subst</span>; <span class="id">simpl</span>. <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_list_le_iff">Rmax_list_le_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">x</span> <span class="id">Hx</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span> <span class="kwd">in</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Hx</span> <span class="kwd">as</span> [<span class="id">a</span> [<span class="id">Ha</span> <span class="id">Hina</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;-<span class="id">Ha</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rplus_le_compat">Rplus_le_compat</a></span>; <span class="id">try</span> (<span class="id">apply</span> <span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_spec">Rmax_spec</a></span>; <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span>; <span class="kwd">exists</span> <span class="id">a</span>; <span class="id">split</span> ; <span class="id">trivial</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="FormalML.utils.ListAdd.html#map_not_nil">map_not_nil</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Rmax_list_map_indep">Rmax_list_map_indep</a></span> {<span class="id">A</span>} (<span class="id">l</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>) (<span class="id">c</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Max_</span>{<span class="id">l</span>}(<span class="kwd">fun</span> <span class="id">_</span> =&gt; <span class="id">c</span>) = <span class="kwd">if</span> <span class="id"><a href="FormalML.lib_utils.LibUtilsListAdd.html#is_nil_dec">is_nil_dec</a></span> <span class="id">l</span> <span class="kwd">then</span> 0 <span class="kwd">else</span> <span class="id">c</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof15')">Proof.</span></div>
<div class="proofscript" id="proof15">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="FormalML.lib_utils.LibUtilsListAdd.html#is_nil_dec">is_nil_dec</a></span> <span class="id">l</span>); <span class="id">try</span> <span class="id">now</span> <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_antisym">Rle_antisym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_list_le_iff">Rmax_list_le_iff</a></span>; <span class="id">try</span> <span class="id">rewrite</span> <span class="id"><a href="FormalML.utils.ListAdd.html#map_not_nil">map_not_nil</a></span>; <span class="id">try</span> <span class="id">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">x</span> <span class="id">Hx</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span> <span class="kwd">in</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Hx</span> <span class="kwd">as</span> [<span class="id">x0</span> [<span class="id">Hx0</span> <span class="id">Hx0</span>']].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">subst</span>. <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_spec">Rmax_spec</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="FormalML.utils.BasicUtils.html#ne_symm">BasicUtils.ne_symm</a></span> <span class="kwd">in</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="FormalML.utils.ListAdd.html#not_nil_exists">not_nil_exists</a></span> <span class="kwd">in</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">n</span> <span class="kwd">as</span> [<span class="id">x</span> <span class="id">Hx</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">x</span>; <span class="id">easy</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">Rmax_list_const_add</span>' {<span class="id">A</span>}(<span class="id">l</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>) (<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span>) (<span class="id">d</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_list">Rmax_list</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">f</span> <span class="id">x</span> + <span class="id">d</span>) <span class="id">l</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> (<span class="id"><a href="FormalML.lib_utils.LibUtilsListAdd.html#is_nil_dec">is_nil_dec</a></span> <span class="id">l</span>) <span class="kwd">then</span> 0 <span class="kwd">else</span> ((<span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_list">Rmax_list</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id">f</span> <span class="id">l</span>)) + <span class="id">d</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof16')">Proof.</span></div>
<div class="proofscript" id="proof16">
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="FormalML.lib_utils.LibUtilsListAdd.html#is_nil_dec">is_nil_dec</a></span> <span class="id">l</span>); <span class="id">subst</span>; <span class="id">try</span> <span class="id">easy</span>.<br/>
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">simpl</span>; <span class="id">intuition</span> <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl</span> ; <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl</span> <span class="kwd">in</span> * ; <span class="id">rewrite</span> <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">rewrite</span> <span class="id">Rcomplements.Rplus_max_distr_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="FormalML.utils.BasicUtils.html#ne_symm">BasicUtils.ne_symm</a></span>. <span class="id">rewrite</span> <span class="id"><a href="FormalML.utils.ListAdd.html#not_nil_exists">not_nil_exists</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">a0</span>; <span class="id">simpl</span>. <span class="id">now</span> <span class="id">left</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Q_is_bounded">Q_is_bounded</a></span> <span class="id">W</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">ls</span>, <span class="id">_</span>) := <span class="id"><a href="FormalML.CertRL.mdp.html#fs">fs</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">las</span>,<span class="id">_</span>) := <span class="id"><a href="FormalML.CertRL.mdp.html#act_finite">act_finite</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Max_</span>{<span class="id">ls</span>}(<span class="kwd">fun</span> <span class="id">s</span>' =&gt; <span class="id">Max_</span>{<span class="id">las</span>}(<span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ">bellmanQ</a></span> <span class="id">W</span> <span class="id">s</span>')) &lt;= <span class="id">Max_</span>{ <span class="id">ls</span>}<br/>
&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">s</span>' : <span class="id"><a href="FormalML.CertRL.mdp.html#state">state</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id">Max_</span>{ <span class="id">las</span>}(<span class="kwd">fun</span> <span class="id">sa</span> : {<span class="id">x</span> : <span class="id"><a href="FormalML.CertRL.mdp.html#state">state</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span> &amp; <span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span> <span class="id">x</span>} =&gt; <span class="kwd">let</span> (<span class="id">s</span>, <span class="id">a</span>) := <span class="id">sa</span> <span class="kwd">in</span> <span class="id"><a href="FormalML.CertRL.mdp.html#reward">reward</a></span> <span class="id">s</span> <span class="id">a</span> <span class="id">s</span>')) + γ*<span class="id">Max_</span>{<span class="id">las</span>}(<span class="id">W</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof17')">Proof.</span></div>
<div class="proofscript" id="proof17">
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="FormalML.CertRL.mdp.html#fs">fs</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>) <span class="kwd">as</span> [<span class="id">states</span> ?].<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="FormalML.CertRL.mdp.html#act_finite">act_finite</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>) <span class="kwd">as</span> [<span class="id">stacts</span> ?].<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ">bellmanQ</a></span>.<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">G1</span> : [] &lt;&gt; <span class="id">states</span>) <span class="kwd">by</span> (<span class="id">rewrite</span> <span class="id"><a href="FormalML.utils.ListAdd.html#not_nil_exists">not_nil_exists</a></span>; <span class="id">now</span> <span class="kwd">exists</span> (@<span class="id"><a href="FormalML.CertRL.mdp.html#ne">ne</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>)).<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">H0</span> : [] &lt;&gt; <span class="id">stacts</span>) <span class="kwd">by</span> (<span class="id">rewrite</span> <span class="id"><a href="FormalML.utils.ListAdd.html#not_nil_exists">not_nil_exists</a></span>; <span class="id">now</span> <span class="kwd">exists</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> (@<span class="id"><a href="FormalML.CertRL.mdp.html#ne">ne</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>) (@<span class="id"><a href="FormalML.CertRL.mdp.html#na">na</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span> (@<span class="id"><a href="FormalML.CertRL.mdp.html#ne">ne</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>)))).<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">G2</span> : <span class="kwd">forall</span> <span class="id">s</span> : <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#state">state</a></span>), [] &lt;&gt; <span class="id"><a href="FormalML.CertRL.mdp.html#act_list">act_list</a></span> <span class="id">s</span>) <span class="kwd">by</span> (<span class="id">intros</span> <span class="id">s</span>; <span class="id">apply</span> <span class="id"><a href="FormalML.CertRL.mdp.html#act_list_not_nil">act_list_not_nil</a></span>).<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">H1</span> : <span class="id">Max_</span>{<span class="id">states</span>} (<span class="kwd">fun</span> <span class="id">s</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Max_</span>{<span class="id">stacts</span>}(<span class="kwd">fun</span> <span class="id">sa</span> : {<span class="id">x</span> : <span class="id"><a href="FormalML.CertRL.mdp.html#state">state</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span> &amp; <span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span> <span class="id">x</span>} =&gt; <span class="kwd">let</span> (<span class="id">s</span>,<span class="id">a</span>):= <span class="id">sa</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FormalML.CertRL.mdp.html#reward">reward</a></span> <span class="id">s</span> <span class="id">a</span> <span class="id">s</span>' + γ*(<span class="id">Max_</span>{ <span class="id"><a href="FormalML.CertRL.mdp.html#act_list">act_list</a></span> <span class="id">s</span>' }(<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id">W</span>(<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">s</span>' <span class="id">a</span>))))) &lt;=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Max_</span>{<span class="id">states</span>} (<span class="kwd">fun</span> <span class="id">s</span>' =&gt; <span class="id">Max_</span>{<span class="id">stacts</span>}(<span class="kwd">fun</span> <span class="id">sa</span> : {<span class="id">x</span> : <span class="id"><a href="FormalML.CertRL.mdp.html#state">state</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span> &amp; <span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span> <span class="id">x</span>} =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">s</span>,<span class="id">a</span>):= <span class="id">sa</span> <span class="kwd">in</span> <span class="id"><a href="FormalML.CertRL.mdp.html#reward">reward</a></span> <span class="id">s</span> <span class="id">a</span> <span class="id">s</span>'))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+  γ*( <span class="id">Max_</span>{<span class="id">states</span>}(<span class="kwd">fun</span> <span class="id">s</span>' =&gt; <span class="id">Max_</span>{<span class="id">stacts</span>}(<span class="kwd">fun</span> <span class="id">sa</span> =&gt; <span class="id">Max_</span>{ <span class="id"><a href="FormalML.CertRL.mdp.html#act_list">act_list</a></span> <span class="id">s</span>' }(<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id">W</span>(<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">s</span>' <span class="id">a</span>)))))).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> &lt;-<span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_list_map_const_mul">Rmax_list_map_const_mul</a></span>; <span class="id">try</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_trans">Rle_trans</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2: <span class="id">apply</span> <span class="id"><a href="FormalML.CertRL.qvalues.html#Rmax_list_map_add">Rmax_list_map_add</a></span>. <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_list_fun_le">Rmax_list_fun_le</a></span>; <span class="id">intros</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id"><a href="FormalML.CertRL.qvalues.html#Rmax_list_map_indep">Rmax_list_map_indep</a></span>; <span class="id">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="FormalML.lib_utils.LibUtilsListAdd.html#is_nil_dec">is_nil_dec</a></span> <span class="id">stacts</span>); <span class="id">try</span> <span class="id">subst</span>. <span class="id">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span>  (γ *(<span class="id">Max_</span>{ <span class="id"><a href="FormalML.CertRL.mdp.html#act_list">act_list</a></span> <span class="id">s</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">a0</span> : <span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span> <span class="id">s</span> =&gt; <span class="id">W</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> (<span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>) <span class="id">s</span> <span class="id">a0</span>)))); <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> (<span class="id"><a href="FormalML.CertRL.qvalues.html#Rmax_list_map_add">Rmax_list_map_add</a></span> (<span class="kwd">fun</span> <span class="id">sa</span> : {<span class="id">x</span> : <span class="id"><a href="FormalML.CertRL.mdp.html#state">state</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span> &amp; <span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span> <span class="id">x</span>} =&gt; <span class="kwd">let</span> (<span class="id">s0</span>, <span class="id">a</span>) := <span class="id">sa</span> <span class="kwd">in</span> <span class="id"><a href="FormalML.CertRL.mdp.html#reward">reward</a></span> <span class="id">s0</span> <span class="id">a</span> <span class="id">s</span>) (<span class="kwd">fun</span> <span class="id">_</span> =&gt; <span class="id">r</span>) <span class="id">stacts</span>); <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id"><a href="FormalML.CertRL.qvalues.html#Rmax_list_map_indep">Rmax_list_map_indep</a></span>) <span class="kwd">with</span> (<span class="id">c</span> := <span class="id">r</span>) <span class="kwd">in</span> <span class="id">H</span>; <span class="id">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_destr_in</span> <span class="id">H</span>; <span class="id">simpl</span>. <span class="id">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_trans">Rle_trans</a></span>. 2: <span class="id">apply</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="id">apply</span> <span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_list_map_ext">Rmax_list_map_ext</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">destruct</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_trans">Rle_trans</a></span>; <span class="id">eauto</span>. <span class="id">clear</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rplus_le_compat">Rplus_le_compat</a></span>.<br/>
&nbsp;&nbsp;+ <span class="id">now</span> <span class="id">right</span>.<br/>
&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rmult_le_compat_l">Rmult_le_compat_l</a></span>; <span class="id">try</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id"><a href="FormalML.CertRL.qvalues.html#Rmax_list_map_indep">Rmax_list_map_indep</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_destr</span>; <span class="id">subst</span>. <span class="id">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_spec">Rmax_spec</a></span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> (<span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_list_map_exist">Rmax_list_map_exist</a></span> (<span class="kwd">fun</span> <span class="id">s</span>' =&gt; <span class="id">Max_</span>{ <span class="id"><a href="FormalML.CertRL.mdp.html#act_list">act_list</a></span> <span class="id">s</span>'}(<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id">W</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">s</span>' <span class="id">a</span>))) <span class="id">_</span> <span class="id">G1</span>); <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">s0</span> [<span class="id">Hs0</span> <span class="id">Heq1</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> (<span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_list_map_exist">Rmax_list_map_exist</a></span> (<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id">W</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">s0</span> <span class="id">a</span>)) <span class="id">_</span> (<span class="id">G2</span> <span class="id">s0</span>)); <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">a</span> [<span class="id">Ha1</span> <span class="id">Heq2</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">s0</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;-<span class="id">Heq1</span>. <span class="id">rewrite</span> <span class="id">Heq2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; <span class="id">trivial</span>.<br/>
Qed.</div>
<br/>
<span class="id">Local</span> <span class="kwd">Instance</span> <span class="id"><a name="EqDecsigT">EqDecsigT</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Classes.EquivDec.html#EqDec">EqDec</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#sigT">sigT</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span>)) <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof18')">Proof.</span></div>
<div class="proofscript" id="proof18">
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">x</span> <span class="id">y</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Logic.ClassicalDescription.html#excluded_middle_informative">ClassicalDescription.excluded_middle_informative</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">bellmanQ</span>' (<span class="id">sa0</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#sigT">sigT</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span>)) : <span class="id"><a href="FormalML.CertRL.mdp.html#Rfct">Rfct</a></span>(<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#sigT">sigT</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span>)) -&gt; <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#state">state</a></span>) -&gt; <span class="id"><a href="FormalML.CertRL.mdp.html#Rfct">Rfct</a></span>(<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#sigT">sigT</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span>))<br/>
&nbsp;&nbsp;:= <span class="kwd">fun</span> <span class="id">W</span> =&gt; <span class="kwd">fun</span> <span class="id">s</span>' <span class="id">sa</span> =&gt; <span class="kwd">if</span> (<span class="id">sa</span> == <span class="id">sa0</span>) <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">s</span>,<span class="id">a</span>) := <span class="id">sa</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FormalML.CertRL.mdp.html#reward">reward</a></span> <span class="id">s</span> <span class="id">a</span> <span class="id">s</span>' + γ*<span class="id">Max_</span>{<span class="id"><a href="FormalML.CertRL.mdp.html#act_list">act_list</a></span> <span class="id">s</span>'}(<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id">W</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">s</span>' <span class="id">a</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">W</span> <span class="id">sa</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">bellmanQbar</span>' (<span class="id">sa0</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#sigT">sigT</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span>)) : <span class="id"><a href="FormalML.CertRL.mdp.html#Rfct">Rfct</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#sigT">sigT</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span>)) -&gt; <span class="id"><a href="FormalML.CertRL.mdp.html#Rfct">Rfct</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#sigT">sigT</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span>))<br/>
&nbsp;&nbsp;:= <span class="kwd">fun</span> <span class="id">W</span> =&gt; <span class="kwd">fun</span> <span class="id">sa</span> =&gt; <span class="kwd">if</span> (<span class="id">sa</span> == <span class="id">sa0</span>) <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">s</span>,<span class="id">a</span>) := <span class="id">sa</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FormalML.CertRL.qvalues.html#act_expt_reward">act_expt_reward</a></span> <span class="id">s</span> <span class="id">a</span> +<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;γ*<span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value">expt_value</a></span> (<span class="id"><a href="FormalML.CertRL.mdp.html#t">t</a></span> <span class="id">s</span> <span class="id">a</span>)(<span class="kwd">fun</span> <span class="id">s</span>' =&gt; <span class="id">Max_</span>{<span class="id"><a href="FormalML.CertRL.mdp.html#act_list">act_list</a></span> <span class="id">s</span>'}(<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id">W</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">s</span>' <span class="id">a</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="kwd">let</span> (<span class="id">s</span>,<span class="id">a</span>) := <span class="id">sa</span> <span class="kwd">in</span> <span class="id">W</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">s</span> <span class="id">a</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">stochasticBellmanQ</span>' (<span class="id">sa0</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#sigT">sigT</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span>)) :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">W</span> =&gt; <span class="kwd">fun</span> <span class="id">s</span>' <span class="id">sa</span> =&gt; (<span class="id">bellmanQ</span>' <span class="id">sa0</span> <span class="id">W</span> <span class="id">s</span>' <span class="id">sa</span> - <span class="id">bellmanQbar</span>' <span class="id">sa0</span> <span class="id">W</span> <span class="id">sa</span>).<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id">expt_value_stochasticBellmanQ</span>' <span class="id">W</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">sa</span> <span class="id">sa0</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#sigT">sigT</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">s</span>,<span class="id">a</span>) := <span class="id">sa</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value">expt_value</a></span> (<span class="id"><a href="FormalML.CertRL.mdp.html#t">t</a></span> <span class="id">s</span> <span class="id">a</span>) (<span class="kwd">fun</span> <span class="id">s</span>' =&gt; <span class="id">stochasticBellmanQ</span>' <span class="id">sa0</span> <span class="id">W</span> <span class="id">s</span>' <span class="id">sa</span>) = 0.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof19')">Proof.</span></div>
<div class="proofscript" id="proof19">
&nbsp;&nbsp;<span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">sa</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id">stochasticBellmanQ</span>'.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value_sub">expt_value_sub</a></span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value_const">expt_value_const</a></span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id">bellmanQbar</span>', <span class="id">bellmanQ</span>'.<br/>
&nbsp;&nbsp;<span class="id">match_destr</span>.<br/>
&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value_add">expt_value_add</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value_const_mul">expt_value_const_mul</a></span>. <span class="id">unfold</span> <span class="id"><a href="FormalML.CertRL.qvalues.html#act_expt_reward">act_expt_reward</a></span>. <span class="id">lra</span>.<br/>
&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value_const">expt_value_const</a></span>; <span class="id">lra</span>.<br/>
Qed.</div>
<br/>
<br/>
&nbsp;<span class="kwd">Theorem</span> <span class="id"><a name="expt_value_bellmanQbar">expt_value_bellmanQbar</a></span> <span class="id">sa0</span> <span class="id">W</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sa</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#sigT">sigT</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span>), <span class="kwd">let</span> (<span class="id">s</span>,<span class="id">a</span>) := <span class="id">sa</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value">expt_value</a></span> (<span class="id"><a href="FormalML.CertRL.mdp.html#t">t</a></span> <span class="id">s</span> <span class="id">a</span>) (<span class="kwd">fun</span> <span class="id">a0</span> : <span class="id"><a href="FormalML.CertRL.mdp.html#state">state</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span> =&gt; <span class="id">bellmanQ</span>' <span class="id">sa0</span> <span class="id">W</span> <span class="id">a0</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> (<span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>) <span class="id">s</span> <span class="id">a</span>)) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">bellmanQbar</span>' <span class="id">sa0</span> <span class="id">W</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> (<span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>) <span class="id">s</span> <span class="id">a</span>)).<br/>
<div>&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof20')">Proof.</span></div>
<div class="proofscript" id="proof20">
&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [<span class="id">s</span> <span class="id">a</span>].<br/>
&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id">bellmanQbar</span>'.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id">bellmanQ</span>'.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">match_destr</span>.<br/>
&nbsp;&nbsp;&nbsp;+ <span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value_add">expt_value_add</a></span>, <span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value_const_mul">expt_value_const_mul</a></span>.<br/>
&nbsp;&nbsp;&nbsp;+ <span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value_const">expt_value_const</a></span>.<br/>
&nbsp;Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">expt_value_rsqr_stochasticBellmanQ</span>' <span class="id">W</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">sa</span> <span class="id">sa0</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#sigT">sigT</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">s</span>,<span class="id">a</span>) := <span class="id">sa</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value">expt_value</a></span> (<span class="id"><a href="FormalML.CertRL.mdp.html#t">t</a></span> <span class="id">s</span> <span class="id">a</span>) (<span class="kwd">fun</span> <span class="id">s</span>' =&gt; (<span class="id">stochasticBellmanQ</span>' <span class="id">sa0</span> <span class="id">W</span> <span class="id">s</span>' <span class="id">sa</span>)²) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value">expt_value</a></span> (<span class="id"><a href="FormalML.CertRL.mdp.html#t">t</a></span> <span class="id">s</span> <span class="id">a</span>) (<span class="kwd">fun</span> <span class="id">s</span>' =&gt; (<span class="id">bellmanQ</span>' <span class="id">sa0</span> <span class="id">W</span> <span class="id">s</span>' <span class="id">sa</span>)²) - (<span class="id">bellmanQbar</span>' <span class="id">sa0</span> <span class="id">W</span> <span class="id">sa</span>)².<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof21')">Proof.</span></div>
<div class="proofscript" id="proof21">
&nbsp;&nbsp;<span class="id">intros</span> [<span class="id">s</span> <span class="id">a</span>] <span class="id">sa0</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id">stochasticBellmanQ</span>'.<br/>
&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.R_sqr.html#Rsqr_minus">Rsqr_minus</a></span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value_sub">expt_value_sub</a></span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value_add">expt_value_add</a></span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value_const">expt_value_const</a></span>.<br/>
&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rmult_assoc">Rmult_assoc</a></span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value_const_mul">expt_value_const_mul</a></span>.<br/>
&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rmult_comm">Rmult_comm</a></span> <span class="kwd">at</span> 4.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value_const_mul">expt_value_const_mul</a></span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id"><a href="FormalML.CertRL.qvalues.html#expt_value_bellmanQbar">expt_value_bellmanQbar</a></span> <span class="id">sa0</span> <span class="id">W</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">s</span> <span class="id">a</span>)).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> &lt;-<span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rmult_assoc">Rmult_assoc</a></span>. <span class="id">unfold</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rsqr">Rsqr</a></span>. <span class="id">ring</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Rmax_list_const">Rmax_list_const</a></span> {<span class="id">A</span> : <span class="kwd">Type</span>} (<span class="id">r</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span>) (<span class="id">l</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>):<br/>
&nbsp;&nbsp;[] &lt;&gt; <span class="id">l</span> -&gt; <span class="id">Max_</span>{<span class="id">l</span>}(<span class="kwd">fun</span> <span class="id">_</span> =&gt; <span class="id">r</span>) = <span class="id">r</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof22')">Proof.</span></div>
<div class="proofscript" id="proof22">
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">Hl</span>.<br/>
&nbsp;&nbsp;<span class="id">symmetry</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_antisym">Rle_antisym</a></span>.<br/>
&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_spec">Rmax_spec</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="FormalML.utils.ListAdd.html#not_nil_exists">not_nil_exists</a></span> <span class="kwd">in</span> <span class="id">Hl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Hl</span> <span class="kwd">as</span> [<span class="id">a</span> <span class="id">Ha</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">a</span>. <span class="id">split</span>; <span class="id">trivial</span>.<br/>
&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_list_le_iff">Rmax_list_le_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span> <span class="kwd">in</span> <span class="id">Ha</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Ha</span> <span class="kwd">as</span> [<span class="id">b</span> [? ?]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subst</span>; <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="FormalML.utils.ListAdd.html#map_not_nil">map_not_nil</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Rmax_list_Rabs_pos">Rmax_list_Rabs_pos</a></span> {<span class="id">A</span> : <span class="kwd">Type</span>} (<span class="id">l</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>) (<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span>) :<br/>
&nbsp;&nbsp;0 &lt;= <span class="id">Max_</span>{<span class="id">l</span>} (<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs">Rabs</a></span> (<span class="id">f</span> <span class="id">a</span>)).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof23')">Proof.</span></div>
<div class="proofscript" id="proof23">
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="FormalML.lib_utils.LibUtilsListAdd.html#is_nil_dec">is_nil_dec</a></span> <span class="id">l</span>); <span class="id">try</span> <span class="id">subst</span>.<br/>
&nbsp;&nbsp;+ <span class="id">now</span> <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="FormalML.utils.BasicUtils.html#ne_symm">BasicUtils.ne_symm</a></span> <span class="kwd">in</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> (<span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_list_map_exist">Rmax_list_map_exist</a></span> (<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs">Rabs</a></span>(<span class="id">f</span> <span class="id">a</span>)) <span class="id">l</span> <span class="id">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [<span class="id">a</span> [<span class="id">Ha1</span> <span class="id">Ha2</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;-<span class="id">Ha2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs_pos">Rabs_pos</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Rplus_le_compat_Rsqr">Rplus_le_compat_Rsqr</a></span> {<span class="id">a</span> <span class="id">b</span> <span class="id">c</span> <span class="id">d</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span>} (<span class="id">hab</span> : 0 &lt;= <span class="id">a</span> &lt;= <span class="id">c</span>) (<span class="id">hbd</span> : 0 &lt;= <span class="id">b</span> &lt;= <span class="id">d</span>) :<br/>
&nbsp;&nbsp;(<span class="id">a</span> + <span class="id">b</span>)² &lt;= (<span class="id">c</span> + <span class="id">d</span>)².<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof24')">Proof.</span></div>
<div class="proofscript" id="proof24">
&nbsp;&nbsp;<span class="id">do</span> 2 <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.R_sqr.html#Rsqr_plus">Rsqr_plus</a></span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rplus_le_compat">Rplus_le_compat</a></span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rplus_le_compat">Rplus_le_compat</a></span>.<br/>
&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.R_sqr.html#Rsqr_le_abs_1">Rsqr_le_abs_1</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs_right">Rabs_right</a></span>; <span class="id">try</span> <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs_right">Rabs_right</a></span>; <span class="id">try</span> <span class="id">intuition</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.R_sqr.html#Rsqr_le_abs_1">Rsqr_le_abs_1</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs_right">Rabs_right</a></span>; <span class="id">try</span> <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs_right">Rabs_right</a></span>; <span class="id">try</span> <span class="id">intuition</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rmult_le_compat">Rmult_le_compat</a></span>; <span class="id">try</span> <span class="id">intuition</span> <span class="id">lra</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Rmax_list_map_dep_prod">Rmax_list_map_dep_prod</a></span> {<span class="id">A</span> : <span class="kwd">Type</span>} {<span class="id">B</span> : <span class="id">A</span> -&gt; <span class="kwd">Type</span>} (<span class="id">la</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>) (<span class="id">lb</span> : <span class="kwd">forall</span> <span class="id">a</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id">B</span> <span class="id">a</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hb</span> : <span class="kwd">forall</span> <span class="id">a</span>, [] &lt;&gt; <span class="id">lb</span> <span class="id">a</span>) (<span class="id">f</span> : <span class="kwd">forall</span> <span class="id">x</span> :<span class="id">A</span>, <span class="id">B</span> <span class="id">x</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Max_</span>{ <span class="id">la</span>}(<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id">Max_</span>{<span class="id">lb</span> <span class="id">a</span>} (<span class="kwd">fun</span> <span class="id">b</span> =&gt; <span class="id">f</span> <span class="id">a</span> <span class="id">b</span>)) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Max_</span>{<span class="id"><a href="FormalML.utils.Finite.html#list_dep_prod">list_dep_prod</a></span> <span class="id">la</span> <span class="id">lb</span>}(<span class="kwd">fun</span> <span class="id">ab</span> : {<span class="id">x</span> : <span class="id">A</span> &amp; <span class="id">B</span> <span class="id">x</span>} =&gt; <span class="kwd">let</span> (<span class="id">a</span>,<span class="id">b</span>) := <span class="id">ab</span> <span class="kwd">in</span> <span class="id">f</span> <span class="id">a</span> <span class="id">b</span>).<br/>
<div>&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof25')">Proof.</span></div>
<div class="proofscript" id="proof25">
&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="FormalML.lib_utils.LibUtilsListAdd.html#is_nil_dec">is_nil_dec</a></span> <span class="id">la</span>); <span class="id">subst</span>; <span class="id">try</span> <span class="id">simpl</span>; <span class="id">try</span> <span class="id">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Ha</span> : [] &lt;&gt; <span class="id">la</span>) <span class="kwd">by</span> <span class="id">congruence</span>. <span class="id">clear</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_antisym">Rle_antisym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;++  <span class="id">rewrite</span> <span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_list_le_iff">Rmax_list_le_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">intros</span> <span class="id">x</span> <span class="id">Hx</span>. <span class="id">eapply</span> (@<span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_list_ge">Rmax_list_ge</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Hx</span> <span class="kwd">as</span> [<span class="id">a</span> [<span class="id">Hx</span>' <span class="id">HInx</span>']].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">set</span> (<span class="id">Hmax</span> := <span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_list_map_exist">Rmax_list_map_exist</a></span> (<span class="kwd">fun</span> <span class="id">b</span> : <span class="id">B</span> <span class="id">a</span>=&gt; <span class="id">f</span> <span class="id">a</span> <span class="id">b</span>) (<span class="id">lb</span> <span class="id">a</span>) (<span class="id">Hb</span> <span class="id">a</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Hmax</span> <span class="kwd">as</span> [<span class="id">b</span> [<span class="id">Hb1</span> <span class="id">Hb2</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">a</span> <span class="id">b</span>). <span class="id">simpl</span>. <span class="id">split</span>; [<span class="id">now</span> <span class="id">rewrite</span> &lt;-<span class="id">Hx</span>' |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="FormalML.utils.Finite.html#in_dep_prod">in_dep_prod</a></span>; <span class="id">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id">now</span> <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="FormalML.utils.ListAdd.html#map_not_nil">map_not_nil</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">rewrite</span> <span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_list_le_iff">Rmax_list_le_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">intros</span> <span class="id">x</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span> <span class="kwd">in</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Hx</span> <span class="kwd">as</span> [<span class="id">ab</span> [<span class="id">Hab1</span> <span class="id">HInab1</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_list_ge">Rmax_list_ge</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#projT1">projT1</a></span> <span class="id">ab</span>). <span class="id">split</span> ; <span class="id">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">ab</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id"><a href="FormalML.utils.Finite.html#in_dep_prod_iff">in_dep_prod_iff</a></span> <span class="kwd">in</span> <span class="id">HInab1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">HInab1</span> ; <span class="id">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id">eapply</span> (<span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_list_ge">Rmax_list_ge</a></span> <span class="id">_</span> <span class="id">_</span> (<span class="id">f</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#projT1">projT1</a></span> <span class="id">ab</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#projT2">projT2</a></span> <span class="id">ab</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+++ <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span>. <span class="kwd">exists</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#projT2">projT2</a></span> <span class="id">ab</span>). <span class="id">split</span> ; <span class="id">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">ab</span> <span class="kwd">as</span> [<span class="id">a</span> <span class="id">b</span>]; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="FormalML.utils.Finite.html#in_dep_prod_iff">in_dep_prod_iff</a></span> <span class="kwd">in</span> <span class="id">HInab1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">HInab1</span> ; <span class="id">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+++ <span class="id">rewrite</span> &lt;-<span class="id">Hab1</span>; <span class="id">destruct</span> <span class="id">ab</span>; <span class="id">simpl</span>. <span class="id">right</span> ; <span class="id">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">rewrite</span> <span class="id"><a href="FormalML.utils.ListAdd.html#map_not_nil">map_not_nil</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="FormalML.utils.ListAdd.html#not_nil_exists">not_nil_exists</a></span> <span class="kwd">in</span> <span class="id">Ha</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Ha</span> <span class="kwd">as</span> [<span class="id">a</span> <span class="id">H</span>]. <span class="id">specialize</span> (<span class="id">Hb</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="FormalML.utils.ListAdd.html#not_nil_exists">not_nil_exists</a></span> <span class="kwd">in</span> <span class="id">Hb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Hb</span> <span class="kwd">as</span> [<span class="id">b</span> <span class="id">Hb</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="FormalML.utils.ListAdd.html#not_nil_exists">not_nil_exists</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">a</span> <span class="id">b</span>). <span class="id">rewrite</span> <span class="id"><a href="FormalML.utils.Finite.html#in_dep_prod_iff">in_dep_prod_iff</a></span>; <span class="id">split</span>; <span class="id">trivial</span>.<br/>
&nbsp;Qed.</div>
<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id">noise_variance_bound</span>' (<span class="id">sa0</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#sigT">sigT</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span>)) <span class="id">W</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sa</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#sigT">sigT</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span>), <span class="kwd">let</span> (<span class="id">s</span>,<span class="id">a</span>) := <span class="id">sa</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">ls</span>,<span class="id">_</span>) := <span class="id"><a href="FormalML.CertRL.mdp.html#fs">fs</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FormalML.CertRL.pmf_monad.html#variance">variance</a></span> (<span class="id"><a href="FormalML.CertRL.mdp.html#t">t</a></span> <span class="id">s</span> <span class="id">a</span>) (<span class="kwd">fun</span> <span class="id">s</span>' =&gt; <span class="id">stochasticBellmanQ</span>' <span class="id">sa0</span> <span class="id">W</span> <span class="id">s</span>' <span class="id">sa</span>) &lt;=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Max_</span>{<span class="id">ls</span>}(<span class="kwd">fun</span> <span class="id">s</span>' =&gt; <span class="id">Max_</span>{<span class="id">ls</span>}(<span class="kwd">fun</span> <span class="id">s</span> =&gt; <span class="id">Max_</span>{<span class="id"><a href="FormalML.CertRL.mdp.html#act_list">act_list</a></span> <span class="id">s</span>}( <span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs">Rabs</a></span> (<span class="id"><a href="FormalML.CertRL.mdp.html#reward">reward</a></span> <span class="id">s</span> <span class="id">a</span> <span class="id">s</span>')))) +<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;γ*(<span class="id">Max_</span>{ <span class="id">ls</span>} (<span class="kwd">fun</span> <span class="id">a0</span> : <span class="id"><a href="FormalML.CertRL.mdp.html#state">state</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs">Rabs</a></span> (<span class="id">Max_</span>{ <span class="id"><a href="FormalML.CertRL.mdp.html#act_list">act_list</a></span> <span class="id">a0</span>}(<span class="kwd">fun</span> <span class="id">a1</span> : <span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span> <span class="id">a0</span> =&gt; <span class="id">W</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> (<span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>) <span class="id">a0</span> <span class="id">a1</span>))))))².<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof26')">Proof.</span></div>
<div class="proofscript" id="proof26">
&nbsp;&nbsp;<span class="id">intros</span> [<span class="id">s</span> <span class="id">a</span>].<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Ha</span> : <span class="kwd">forall</span> <span class="id">s</span> : <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#state">state</a></span>), [] &lt;&gt; <span class="id"><a href="FormalML.CertRL.mdp.html#act_list">act_list</a></span> <span class="id">s</span>) <span class="kwd">by</span> (<span class="id">intros</span> <span class="id">s0</span>; <span class="id">apply</span> <span class="id"><a href="FormalML.CertRL.mdp.html#act_list_not_nil">act_list_not_nil</a></span>).<br/>
&nbsp;&nbsp;<span class="id">generalize</span> (<span class="id"><a href="FormalML.CertRL.qvalues.html#expt_value_le_max">expt_value_le_max</a></span> (<span class="id"><a href="FormalML.CertRL.mdp.html#fs">fs</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>) (<span class="id"><a href="FormalML.CertRL.mdp.html#t">t</a></span> <span class="id">s</span> <span class="id">a</span>)); <span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="FormalML.CertRL.mdp.html#fs">fs</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>) <span class="kwd">as</span> [<span class="id">ls</span> ?].<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hls</span>: [] &lt;&gt; <span class="id">ls</span>) <span class="kwd">by</span> (<span class="id">apply</span> <span class="id"><a href="FormalML.utils.ListAdd.html#not_nil_exists">not_nil_exists</a></span>; <span class="kwd">exists</span> (<span class="id"><a href="FormalML.CertRL.mdp.html#ne">ne</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>); <span class="id">trivial</span>).<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">H</span>γ1 : <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs">Rabs</a></span> (γ) = γ) <span class="kwd">by</span> (<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs_pos_eq">Rabs_pos_eq</a></span>; <span class="id">lra</span>).<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">H</span>γ2 : 0 &lt;= <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs">Rabs</a></span> γ) <span class="kwd">by</span> (<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs_pos">Rabs_pos</a></span>).<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">s</span> <span class="id">a</span> == <span class="id">sa0</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="FormalML.CertRL.pmf_monad.html#variance_eq">variance_eq</a></span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">expt_value_rsqr_stochasticBellmanQ</span>' <span class="id">W</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">s</span> <span class="id">a</span>) <span class="id">sa0</span>).<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id">stochasticBellmanQ</span>'. <span class="id">rewrite</span> <span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value_sub">expt_value_sub</a></span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value_const">expt_value_const</a></span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.R_sqr.html#Rsqr_minus">Rsqr_minus</a></span> <span class="kwd">at</span> 1.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id"><a href="FormalML.CertRL.qvalues.html#expt_value_bellmanQbar">expt_value_bellmanQbar</a></span> <span class="id">sa0</span> <span class="id">W</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">s</span> <span class="id">a</span>)).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rfunctions.html#Rsqr_pow2">Rsqr_pow2</a></span>. <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> &lt;-<span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rfunctions.html#Rsqr_pow2">Rsqr_pow2</a></span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_trans">Rle_trans</a></span>; <span class="id">try</span> <span class="id">apply</span> <span class="id"><a href="FormalML.CertRL.qvalues.html#minus_Rsqr_le">minus_Rsqr_le</a></span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_trans">Rle_trans</a></span>; <span class="id">try</span> <span class="id">apply</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_trans">Rle_trans</a></span>; <span class="id">try</span> (<span class="id">eapply</span> (<span class="id"><a href="FormalML.CertRL.qvalues.html#Rmax_list_Rsqr_Rabs_1">Rmax_list_Rsqr_Rabs_1</a></span>) ; <span class="id">trivial</span>).<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_trans">Rle_trans</a></span>; <span class="id">try</span> (<span class="id">eapply</span> (<span class="id"><a href="FormalML.CertRL.qvalues.html#Rmax_list_Rsqr_Rabs_2">Rmax_list_Rsqr_Rabs_2</a></span>) ; <span class="id">trivial</span>).<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id">bellmanQ</span>'; <span class="id">match_destr</span>.<br/>
&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_trans">Rle_trans</a></span>; <span class="id">try</span> (<span class="id">eapply</span> (<span class="id"><a href="FormalML.CertRL.qvalues.html#Rmax_list_Rsqr_Rabs_3">Rmax_list_Rsqr_Rabs_3</a></span>) ; <span class="id">trivial</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="FormalML.CertRL.qvalues.html#Rplus_le_compat_Rsqr">Rplus_le_compat_Rsqr</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">split</span>; [<span class="id">apply</span> <span class="id"><a href="FormalML.CertRL.qvalues.html#Rmax_list_Rabs_pos">Rmax_list_Rabs_pos</a></span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_list_fun_le">Rmax_list_fun_le</a></span>; <span class="id">intros</span> <span class="id">s</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="FormalML.CertRL.mdp.html#act_list">act_list</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="FormalML.CertRL.qvalues.html#Rmax_list_map_dep_prod">Rmax_list_map_dep_prod</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+++  <span class="id">apply</span> <span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_spec">Rmax_spec</a></span>; <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">s</span> <span class="id">a</span>). <span class="id">split</span>; <span class="id">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="FormalML.utils.Finite.html#in_dep_prod_iff">in_dep_prod_iff</a></span>; <span class="id">split</span>; <span class="id">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="FormalML.CertRL.mdp.html#fa">fa</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+++ <span class="id">intros</span>. <span class="id">apply</span> <span class="id"><a href="FormalML.CertRL.mdp.html#act_list_not_nil">act_list_not_nil</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">split</span>; [<span class="id">apply</span> <span class="id"><a href="FormalML.CertRL.qvalues.html#Rmax_list_Rabs_pos">Rmax_list_Rabs_pos</a></span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs_mult">Rabs_mult</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">H</span>γ1. <span class="id">rewrite</span> <span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_list_map_const_mul">Rmax_list_map_const_mul</a></span>; <span class="id">lra</span>.<br/>
&nbsp;&nbsp;+ <span class="id">intuition</span>.<br/>
&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="FormalML.CertRL.pmf_monad.html#variance_eq">variance_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id">stochasticBellmanQ</span>', <span class="id">bellmanQ</span>', <span class="id">bellmanQbar</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_destr</span>. <span class="id">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> 2 <span class="id">rewrite</span> <span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value_const">expt_value_const</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rminus_eq_0">Rminus_eq_0</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rfunctions.html#Rsqr_pow2">Rsqr_pow2</a></span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Ratan.html#pow2_ge_0">pow2_ge_0</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="noise_total_variance_bound">noise_total_variance_bound</a></span> (<span class="id">sa0</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#sigT">sigT</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span>)) <span class="id">W</span> : <span class="kwd">exists</span> <span class="id">c</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span>,<br/>
&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">lsa</span>,<span class="id">_</span>) := <span class="id"><a href="FormalML.CertRL.mdp.html#act_finite">act_finite</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id"><a href="FormalML.utils.RealAdd.html#list_sum">list_sum</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">sa</span> : {<span class="id">x</span> : <span class="id"><a href="FormalML.CertRL.mdp.html#state">state</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span> &amp; <span class="id">_</span>}  =&gt; <span class="kwd">let</span> (<span class="id">s</span>,<span class="id">a</span>) := <span class="id">sa</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FormalML.CertRL.pmf_monad.html#variance">variance</a></span> (<span class="id"><a href="FormalML.CertRL.mdp.html#t">t</a></span> <span class="id">s</span> <span class="id">a</span>) (<span class="kwd">fun</span> <span class="id">s</span>' =&gt; <span class="id">stochasticBellmanQ</span>' <span class="id">sa0</span> <span class="id">W</span> <span class="id">s</span>' <span class="id">sa</span>)) <span class="id">lsa</span>)<br/>
&nbsp;&nbsp;&lt;= <span class="id">c</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof27')">Proof.</span></div>
<div class="proofscript" id="proof27">
&nbsp;&nbsp;<span class="id">generalize</span> (<span class="id">noise_variance_bound</span>' <span class="id">sa0</span> <span class="id">W</span>); <span class="id">intros</span> <span class="id">Hnvb</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="FormalML.CertRL.mdp.html#fs">fs</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>) <span class="kwd">as</span> [<span class="id">ls</span> ?].<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="FormalML.CertRL.mdp.html#act_finite">act_finite</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>) <span class="kwd">as</span> [<span class="id">lsa</span> ?].<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="FormalML.utils.RealAdd.html#list_sum">list_sum</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">_</span> =&gt; (<span class="id">Max_</span>{<span class="id">ls</span>}(<span class="kwd">fun</span> <span class="id">s</span>' =&gt; <span class="id">Max_</span>{<span class="id">ls</span>}(<span class="kwd">fun</span> <span class="id">s</span> =&gt; <span class="id">Max_</span>{<span class="id"><a href="FormalML.CertRL.mdp.html#act_list">act_list</a></span> <span class="id">s</span>}( <span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs">Rabs</a></span> (<span class="id"><a href="FormalML.CertRL.mdp.html#reward">reward</a></span> <span class="id">s</span> <span class="id">a</span> <span class="id">s</span>')))) +<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;γ*(<span class="id">Max_</span>{ <span class="id">ls</span>} (<span class="kwd">fun</span> <span class="id">a0</span> : <span class="id"><a href="FormalML.CertRL.mdp.html#state">state</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rabs">Rabs</a></span> (<span class="id">Max_</span>{ <span class="id"><a href="FormalML.CertRL.mdp.html#act_list">act_list</a></span> <span class="id">a0</span>}(<span class="kwd">fun</span> <span class="id">a1</span> : <span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span> <span class="id">a0</span> =&gt; <span class="id">W</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> (<span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>) <span class="id">a0</span> <span class="id">a1</span>))))))²) <span class="id">lsa</span>)).<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="FormalML.utils.RealAdd.html#list_sum_le">list_sum_le</a></span>; <span class="id">intros</span> <span class="id">sa</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hnvb</span> <span class="id">sa</span>).<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">sa</span> <span class="kwd">as</span> [<span class="id">s</span> <span class="id">a</span>].<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">Hnvb</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id">stochasticBellmanQ</span>'<span class="id">_false</span> <span class="id">W</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">sa</span> <span class="id">sa0</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#sigT">sigT</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span>)), (<span class="id">sa</span> =/= <span class="id">sa0</span>) -&gt; (<span class="kwd">forall</span> <span class="id">s</span>', <span class="id">stochasticBellmanQ</span>' <span class="id">sa0</span> <span class="id">W</span> <span class="id">s</span>' <span class="id">sa</span> = 0).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof28')">Proof.</span></div>
<div class="proofscript" id="proof28">
&nbsp;&nbsp;<span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id">stochasticBellmanQ</span>', <span class="id">bellmanQbar</span>'.<br/>
&nbsp;&nbsp;<span class="id">match_destr</span>. <span class="id">intuition</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id">bellmanQ</span>'.<br/>
&nbsp;&nbsp;<span class="id">match_destr</span>. <span class="id">intuition</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">sa</span>; <span class="id">lra</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="list_sum_split_ind">list_sum_split_ind</a></span> {<span class="id">A</span> : <span class="kwd">Type</span>} {<span class="id">eq</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Classes.EquivDec.html#EqDec">EqDec</a></span> <span class="id">A</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span>} (<span class="id">l</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>) (<span class="id">a0</span> : <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span>):<br/>
&nbsp;&nbsp;<span class="id"><a href="FormalML.utils.RealAdd.html#list_sum">list_sum</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="kwd">if</span> (<span class="id">a</span> == <span class="id">a0</span>) <span class="kwd">then</span> <span class="id">f</span> <span class="id">a</span> <span class="kwd">else</span> 0) <span class="id">l</span>) =<br/>
&nbsp;&nbsp;<span class="id">f</span> <span class="id">a0</span> * <span class="id"><a href="FormalML.utils.RealAdd.html#list_sum">list_sum</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="kwd">if</span> (<span class="id">a</span> == <span class="id">a0</span>) <span class="kwd">then</span> 1 <span class="kwd">else</span> 0) <span class="id">l</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof29')">Proof.</span></div>
<div class="proofscript" id="proof29">
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;+ <span class="id">simpl</span>. <span class="id">lra</span>.<br/>
&nbsp;&nbsp;+ <span class="id">simpl</span>. <span class="id">match_destr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rmult_plus_distr_l">Rmult_plus_distr_l</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">IHl</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rmult_1_r">Rmult_1_r</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">e</span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">IHl</span>. <span class="id">lra</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="list_sum_split">list_sum_split</a></span> {<span class="id">A</span> : <span class="kwd">Type</span>} {<span class="id">eq</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Classes.EquivDec.html#EqDec">EqDec</a></span> <span class="id">A</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span>} (<span class="id">l</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>) (<span class="id">a0</span> : <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span>):<br/>
&nbsp;&nbsp;<span class="id"><a href="FormalML.utils.RealAdd.html#list_sum">list_sum</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id">f</span> <span class="id">l</span>) = <span class="id"><a href="FormalML.utils.RealAdd.html#list_sum">list_sum</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="kwd">if</span> (<span class="id">a</span> == <span class="id">a0</span>) <span class="kwd">then</span> <span class="id">f</span> <span class="id">a0</span> <span class="kwd">else</span> 0) <span class="id">l</span>) +<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FormalML.utils.RealAdd.html#list_sum">list_sum</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="kwd">if</span> (<span class="id">a</span> &lt;&gt; <span class="id">a0</span>) <span class="kwd">then</span> <span class="id">f</span> <span class="id">a</span> <span class="kwd">else</span> 0) <span class="id">l</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof30')">Proof.</span></div>
<div class="proofscript" id="proof30">
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;+ <span class="id">simpl</span>. <span class="id">lra</span>.<br/>
&nbsp;&nbsp;+ <span class="id">simpl</span>. <span class="id">match_destr</span>; <span class="id">case</span> (<span class="id">a</span> &lt;&gt; <span class="id">a0</span>); <span class="id">intros</span>; <span class="id">try</span> <span class="id">intuition</span>; <span class="id">try</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">IHl</span>. <span class="id">rewrite</span> <span class="id">e</span>; <span class="id">lra</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="list_sum_ind_count_occ">list_sum_ind_count_occ</a></span> {<span class="id">A</span> : <span class="kwd">Type</span>} {<span class="id">eq</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Classes.EquivDec.html#EqDec">EqDec</a></span> <span class="id">A</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span>}(<span class="id">l</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)(<span class="id">a0</span> : <span class="id">A</span>):<br/>
&nbsp;&nbsp;<span class="id"><a href="FormalML.utils.RealAdd.html#list_sum">list_sum</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="kwd">if</span> (<span class="id">a</span> == <span class="id">a0</span>) <span class="kwd">then</span> 1 <span class="kwd">else</span> 0) <span class="id">l</span>) =<br/>
&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Raxioms.html#INR">INR</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#count_occ">count_occ</a></span> <span class="id">eq</span> <span class="id">l</span> <span class="id">a0</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof31')">Proof.</span></div>
<div class="proofscript" id="proof31">
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">l</span>; <span class="id">try</span> <span class="id">now</span> <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">simpl</span>; <span class="id">match_destr</span>.<br/>
&nbsp;&nbsp;+ <span class="id">match_destr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">rewrite</span> <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#S_INR">S_INR</a></span>; <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">intuition</span>.<br/>
&nbsp;&nbsp;+ <span class="id">match_destr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_0_l">Rplus_0_l</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">total_variance_stochasticBellmanQ</span>' (<span class="id">sa0</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#sigT">sigT</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span>)) <span class="id">W</span> :<br/>
&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">lsa</span>,<span class="id">_</span>) := <span class="id"><a href="FormalML.CertRL.mdp.html#act_finite">act_finite</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">lsa_nodup</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nodup">nodup</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#EqDecsigT">EqDecsigT</a></span> <span class="id">lsa</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id"><a href="FormalML.utils.RealAdd.html#list_sum">list_sum</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">sa</span> : {<span class="id">x</span> : <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>.(<span class="id"><a href="FormalML.CertRL.mdp.html#state">state</a></span>) &amp; <span class="id">_</span>} =&gt; <span class="kwd">let</span> (<span class="id">s</span>,<span class="id">a</span>) := <span class="id">sa</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FormalML.CertRL.pmf_monad.html#variance">variance</a></span> (<span class="id"><a href="FormalML.CertRL.mdp.html#t">t</a></span> <span class="id">s</span> <span class="id">a</span>) (<span class="kwd">fun</span> <span class="id">s</span>' =&gt; <span class="id">stochasticBellmanQ</span>' <span class="id">sa0</span> <span class="id">W</span> <span class="id">s</span>' <span class="id">sa</span>)) <span class="id">lsa_nodup</span>) =<br/>
&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">s0</span>,<span class="id">a0</span>) := <span class="id">sa0</span> <span class="kwd">in</span><br/>
<span class="id"><a href="FormalML.CertRL.pmf_monad.html#variance">variance</a></span> (<span class="id"><a href="FormalML.CertRL.mdp.html#t">t</a></span> <span class="id">s0</span> <span class="id">a0</span>) (<span class="kwd">fun</span> <span class="id">s</span>' =&gt; <span class="id">stochasticBellmanQ</span>' (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">s0</span> <span class="id">a0</span>) <span class="id">W</span> <span class="id">s</span>' (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">s0</span> <span class="id">a0</span>)).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof32')">Proof.</span></div>
<div class="proofscript" id="proof32">
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="FormalML.CertRL.mdp.html#act_finite">act_finite</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span>) <span class="kwd">as</span> [<span class="id">lsa</span> ?].<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">lsa_nodup</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="FormalML.CertRL.qvalues.html#list_sum_split">list_sum_split</a></span> <span class="kwd">with</span> (<span class="id">a0</span> := <span class="id">sa0</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> &lt;-<span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rplus_0_r">Rplus_0_r</a></span>.<br/>
&nbsp;&nbsp;<span class="id">f_equal</span>.<br/>
&nbsp;&nbsp;+ <span class="id">destruct</span> <span class="id">sa0</span> <span class="kwd">as</span> [<span class="id">s0</span> <span class="id">a0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="FormalML.CertRL.qvalues.html#list_sum_split_ind">list_sum_split_ind</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;-<span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rmult_1_r">Rmult_1_r</a></span>. <span class="id">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="FormalML.CertRL.qvalues.html#list_sum_ind_count_occ">list_sum_ind_count_occ</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">replace</span> 1 <span class="kwd">with</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Raxioms.html#INR">INR</a></span> 1) <span class="kwd">by</span> <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nodup_In">nodup_In</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#EqDecsigT">EqDecsigT</a></span> <span class="id">lsa</span>); <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hf</span> : <span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">x</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nodup">nodup</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#EqDecsigT">EqDecsigT</a></span> <span class="id">lsa</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">x</span>. <span class="id">rewrite</span> <span class="id">H</span>. <span class="id">apply</span> <span class="id">finite</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> (<span class="id">NoDup_count_occ</span>' <span class="id"><a href="FormalML.CertRL.qvalues.html#EqDecsigT">EqDecsigT</a></span> <span class="id">lsa_nodup</span>); <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hnd</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">lsa_nodup</span>) <span class="kwd">by</span> (<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#NoDup_nodup">NoDup_nodup</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">Hnd</span>. <span class="id">apply</span> <span class="id">Hnd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id">lsa_nodup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nodup_In">nodup_In</a></span>. <span class="id">apply</span> <span class="id">finite</span>.<br/>
&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="FormalML.utils.RealAdd.html#list_sum0_is0">list_sum0_is0</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="FormalML.lib_utils.LibUtilsCoqLibAdd.html#Forall_map">Forall_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>; <span class="id">intros</span> <span class="id">sa</span> <span class="id">Hsa</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_destr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> (<span class="id">stochasticBellmanQ</span>'<span class="id">_false</span> <span class="id">W</span> <span class="id">sa</span> <span class="id">sa0</span> <span class="id">c</span>); <span class="id">intros</span> <span class="id">Hz</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">sa</span> <span class="kwd">as</span> [<span class="id">s</span> <span class="id">a</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="FormalML.CertRL.pmf_monad.html#variance">variance</a></span>. <span class="id">setoid_rewrite</span> <span class="id">Hz</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value_zero">expt_value_zero</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rminus_eq_0">Rminus_eq_0</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#Rsqr_0">Rsqr_0</a></span>. <span class="id">apply</span> <span class="id"><a href="FormalML.CertRL.pmf_monad.html#expt_value_zero">expt_value_zero</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Ltac</span> <span class="id">rmax_le_tac</span> := <span class="id">rewrite</span> <span class="id"><a href="FormalML.utils.RealAdd.html#Rmax_list_le_iff">Rmax_list_le_iff</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">intros</span> <span class="id">x</span> [<span class="id">s</span> [<span class="id">Hs1</span> <span class="id">Hs2</span>]] %<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span>; <span class="id">subst</span> | <span class="id">rewrite</span> <span class="id"><a href="FormalML.utils.ListAdd.html#map_not_nil">map_not_nil</a></span>; <span class="id">try</span> <span class="id">assumption</span>].<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">Q_is_bounded</span>' <span class="id">W</span> <span class="id">sa0</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">ls</span>, <span class="id">_</span>) := <span class="id"><a href="FormalML.CertRL.mdp.html#fs">fs</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">las</span>,<span class="id">_</span>) := <span class="id"><a href="FormalML.CertRL.mdp.html#act_finite">act_finite</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Max_</span>{<span class="id">ls</span>} (<span class="kwd">fun</span> <span class="id">s</span>' =&gt; <span class="id">Max_</span>{<span class="id">las</span>}(<span class="kwd">fun</span> <span class="id">sa</span> =&gt; <span class="id">bellmanQ</span>' <span class="id">sa0</span> <span class="id">W</span> <span class="id">s</span>' <span class="id">sa</span>)) &lt;=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rmax">Rmax</a></span>(<span class="id">Max_</span>{ <span class="id">ls</span>}<br/>
&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">s</span>' : <span class="id"><a href="FormalML.CertRL.mdp.html#state">state</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Max_</span>{ <span class="id">las</span>}(<span class="kwd">fun</span> <span class="id">sa</span> : {<span class="id">x</span> : <span class="id"><a href="FormalML.CertRL.mdp.html#state">state</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span> &amp; <span class="id"><a href="FormalML.CertRL.mdp.html#act">act</a></span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ.M">M</a></span> <span class="id">x</span>} =&gt; <span class="kwd">let</span> (<span class="id">s</span>, <span class="id">a</span>) := <span class="id">sa</span> <span class="kwd">in</span> <span class="id"><a href="FormalML.CertRL.mdp.html#reward">reward</a></span> <span class="id">s</span> <span class="id">a</span> <span class="id">s</span>')) +<br/>
&nbsp;&nbsp;&nbsp;&nbsp;γ*<span class="id">Max_</span>{<span class="id">las</span>}(<span class="id">W</span>)) (<span class="id">Max_</span>{<span class="id">las</span>}(<span class="id">W</span>)).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof33')">Proof.</span></div>
<div class="proofscript" id="proof33">
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="FormalML.CertRL.mdp.html#act_finite">act_finite</a></span> <span class="kwd">as</span> [<span class="id">lsa</span> ?].<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="FormalML.CertRL.mdp.html#fs">fs</a></span> <span class="kwd">as</span> [<span class="id">ls</span> ?].<br/>
&nbsp;&nbsp;<span class="id">rmax_le_tac</span>.<br/>
Admitted.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="FormalML.CertRL.qvalues.html#bellmanQ">bellmanQ</a></span>.<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
